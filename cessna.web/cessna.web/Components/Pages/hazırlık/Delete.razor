@page "/hazirlikkontrol/delete/{teknisyenKod:int}/{ucakKod:int}/{ucusKod:int}"
@rendermode InteractiveServer

@using cessna.web.Models
@using Microsoft.EntityFrameworkCore
@inject CessnasContext Db
@inject NavigationManager Nav

<h3>Delete Inspection</h3>

@if (!string.IsNullOrEmpty(Hata))
{
    <div class="alert alert-danger">@Hata</div>
}

@if (Model == null)
{
    <p>Loading...</p>
}
else
{
    <p>
        Delete this inspection?
        <br />
        <strong>Technician:</strong> @Model.TeknisyenKod
        <br />
        <strong>Aircraft:</strong> @Model.UcakKod
        <br />
        <strong>Flight:</strong> @Model.UcusKod
    </p>

    <button type="button" class="btn btn-danger" @onclick="ConfirmDelete">Delete</button>
    <a class="btn btn-secondary ms-2" href="/hazirlikkontrol">Cancel</a>
}

@code {
    [Parameter] public int teknisyenKod { get; set; }
    [Parameter] public int ucakKod { get; set; }
    [Parameter] public int ucusKod { get; set; }

    HazirlikKontrol? Model;
    string? Hata;

    protected override async Task OnInitializedAsync()
    {
        Model = await Db.Set<HazirlikKontrol>().FirstOrDefaultAsync(x =>
            x.TeknisyenKod == teknisyenKod &&
            x.UcakKod == ucakKod &&
            x.UcusKod == ucusKod);

        if (Model == null)
            Hata = "Inspection not found.";
    }

    async Task ConfirmDelete()
    {
        if (Model == null) return;

        Db.Set<HazirlikKontrol>().Remove(Model);
        await Db.SaveChangesAsync();

        Nav.NavigateTo("/hazirlikkontrol", true);
    }
}
